---
title: Донастройка по инструкциям
created: 2025-12-05
tags:
  - deep_learning
links:
---
**Определение 1:** *Донастройка по инструкциям* - метод улучшения навыка у LLM следования инструкциям. Метод заключается в том, что мы берем предварительно обученную LLM и обучаем её следовать инструкциям для целого диапазона задач, начиная от машинного перевода и заканчивая планом питания, файтюня её на корпусе инструкций и ответов.

Донастройка по инструкциям является формой обучения с учителем, где обучающая выборка состоит из инструкций и мы продолжаем обучать модель на них, используя ту же цель моделирования языка, что и использовалась при обучении исходной модели. В случае казуальных моделей, это просто цель угадывания следующего слова. Обучающий корпус просто рассматривается как дополнительные обучающие данные, а обновления на основе градиента генерируются с использованием потери кросс-энтропии, как и при обучении исходной модели. Несмотря на то, что он обучен предсказывать следующий токен, мы называем этот метод *файтюнингом с учителем*, потому что, в отличие от предварительного обучения, каждая инструкция или вопрос в данных донастройки по инструкциям имеет цель обучения с учителем: правильный ответ или реакция на инструкцию.
Ниже показаны отличия файтюнингов, рассмотренных раннее:

![[Pasted image 20251205004700.png]]

В донастройке инструкций мы адаптируем модель под определенную задачу, добавляя новую специальную голову классификации и обновляя его характеристики с помощью собственной функции потери, параметры предварительно обученной модели могут быть заморожены или слегка обновляться.

В конце, в донастройке инструкциями, мы берем выборку инструкций и их правильных ответах и продолжаем обучение языковой модели на этих данных, основанного на стандартной потери языковой модели.

Дообучение по инструкциям, как и все виды файнтюнинга, гораздо скромнее, чем обучение базовой LLM. Обучение обычно включает несколько эпох по выборке инструкций, число которых измеряется в тысячах. Поэтому конечная стоимость донастройки по инструкциям лишь малая часть общей цены обучения базовой модели.

### Инструкции как обучающие данные

Под инструкцией мы представляем описание в естественном языке задачи для выполнения, совмещенное с маркированной демонстрацией задачи. Это может включать минимальные описания, похожие на промпты. В то же время, так как мы используем обучение с учителем для обновления модели, эти инструкции не должны быть ограничены простыми промптами, предназначенными для вызова поведения, обнаруженного в корпусах до обучения. Инструкции также могут включать в себя ограничения по длине или другие обучения, предполагаемые персоны и демонстрации.

![[Pasted image 20251205010644.png]]

![[Pasted image 20251205010658.png]]

![[Pasted image 20251205010741.png]]

### Оценка настроенных по инструкциям моделей

Цель настройки по инструкциям - это не обучить одной задаче, а следовать инструкциям в целом. Поэтому при оценке методов настройки по инструкциям нам необходимо оценить, насколько модель хорошо выполняет новые задачи, для которых ей не были даны явные инструкции.

Стандартный способ такой оценки - это подход с исключением одного: настройка модели на основе инструкций на некотором большом наборе задач, а затем её оценка на утаенной задаче. Но огромное количество задач в наборах данных для настройки по инструкциям часто перекрывается. Поэтому очевидно, что тестирование на утаенном наборе данных для вывода с сохранением остальных в обучающих данных не будет истинной мерой оценки эффективности модели на выводе как новая задача.

Чтобы решить эту проблему, большие наборы данных для настройки по инструкций разбиваются на кластеры на основе сходства задач. Затем применяется метод "исключения одного" к обучению/тестированию на уровне кластера. То есть, чтобы оценить эффективность модели при анализе тональности, все данные, связанные с анализом тональности удаляются из обучающего набора и резервируются для тестирования. Это имеет дополнительное преимущество, позволяя использовать единую метрику, соответствующую задаче, для отложенной оценки.